案例分析

---

# 淘宝网的架构演化

- 负载均衡 -> 应用服务器(Linux) -> Apache -> PHP -> MySQL (主从复制) 
- 负载均衡 -> 应用服务器(Linux) -> Weblogic-> Webx -> EJB -> IBatis -> Oracle、搜索引擎服务器集群
- 负载均衡 -> 应用服务器(Linux) -> JBoss -> Webx -> Spring -> Ibatis -> Oracle、搜索引擎服务器集群、分布式缓存
- Tair 分布式Key/Value存储引擎，分为持久化和非持久化两种使用方式
- TFS 分布式文件系统，适用于海量小文件存储
- OceanBase 分布式数据库系统，支持千亿级读写事务
- TDDL 对应用透明的分库分表层和具有众多特性的动态数据源

# 维基百科的高性能架构

- 架构主要组成
	- GeoDNS 基于开源域名服务器软件BIND的增强版本，可将域名解析到离用户最近的服务器
	- LVS 基于Linux的开源负载均衡服务器
	- Squid 基于Linux的开源反向代理服务器
	- Lighttpd 开源应用服务器，比Apache更轻量、更快速(作为图片服务器居多)
	- PHP 免费Web开放语言
	- Memcached 无中心高性能开源分布式缓存系统
	- Lucene Java开发的开源全文搜索引擎
	- MySQL 开源关系数据库
	
- 前端性能优化
	- DNS服务、CDN服务、反向代理服务、静态资源服务等
	- 核心是反向代理服务器Squid集群，请求通过LVS负载均衡分发到Squid服务器，热点词条被缓存，大量请求直接返回响应，无需发送到Apache服务器，Squid缓存不能命中的请求再通过LVS发送到Apache服务器，如果有词条更新，使用Invalidation Notification服务通知Squid缓存失效
	- CDN服务，位于反向代理Squid之前，很多热点词条缓存在CDN服务器上，CDN服务器不是这样离用户浏览器最近的地方
		- 页面内存不包含动态信息
		- 每个内容页面具有唯一的REST风格，避免重复缓存
		- 在HTML响应头写入缓存控制信息，通过应用控制内容是否缓存和有效期等

- 服务端性能优化
	- 硬件改善
	- 使用APC PHP字节码缓存模块，加速代码执行减少资源消耗
	- 使用Imagemagick进行图片处理和转化
	- 使用Tex进行文本格式化，特别是讲科学公式内容转换成图片格式
	- 替换PHP的字符串查找函数strtr()，使用更优化的算法重构
	
- 后端性能优化
	- 分布式缓存
		- 热点特别集中的数据直接缓存到应用服务器的本地内存中
		- 缓存数据的内容尽量是应用服务器可以直接使用的格式
		- 使用缓存服务器存储session对象
		- 使用Memcached
	- MySQL优化
		- 使用较大的服务器内存
		- 使用RAID0磁盘阵列以加速磁盘访问(降低了数据库的持久可靠性)
		- 数据库事务一致性设置在较低水平，加快宕机恢复速度
		- 如果Master数据库宕机，立即将应用切换到Salve数据库，同时关闭数据写服务(即关闭词条编辑功能)
	