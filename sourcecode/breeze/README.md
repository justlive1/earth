program scaffolding

---

# 模式

## 分层


 x | -  
---|---
应用层 | 负责具体业务和视图展示，首页及搜索输入和结果展示
服务层 | 为应用提供服务支持，用户管理服务，购物车服务等
数据层 | 提供数据存储访问服务，数据库、缓存、文件、搜索引擎等

- 合理规划层次边界和接口，在开发过程中，严格遵守分层架构的约束，禁止跨层次的调用
- 应用层可细分为视图层（美工）和业务逻辑层（工程师），服务层可细分为数据接口层（适配各种输入和输出的数据格式）和逻辑处理层

## 分割

纵向方面进行切分

- 将不同的功能和服务分割开，包装成高内聚低耦合的模块单元
- 易于开发和维护，便于不同模块的分布式部署
- 提高并发处理能力和功能扩展能力

example：
- 在应用层将不同业务进行分割，购物、论坛、搜索、广告分割成不同应用，由独立团队负责，部署在不同服务器
- 在同一个应用内部可进行继续分割，购物业务可进一步分割成机票酒店业务、3C业务、小商品业务等
- 模块不管在逻辑上还是物理部署上，都可以是独立的
- 同样服务层也可以根据需要将服务分割成合适的模块

## 分布式

分布式意味着可以使用更多的计算机完成同样的功能，计算机越多，CPU、内存、存储资源也越多，能够处理的并发访问和数据量就越大

分布式解决高并发问题同时带来的问题：
- 服务调用必须通过网络，可能会对性能造成严重影响
- 服务越多宕机的概率越大，一台服务器宕机造成服务不可用可能会导致很多应用不能访问
- 数据在分布式环境中保持数据一致性也很困难
- 分布式事务也难以保证
- 依赖错综复杂，开发管理维护困难

常用的分布式方案

- 分布式应用和服务
- 分布式静态资源
- 分布式数据和存储
- 分布式计算
- 分布式配置
- 分布式锁
- 分布式文件


## 集群

使用分布式俗人已经将分层和分割后的模块独立部署，但对于用户访问集中的模块，还需要讲独立部署的服务器集群化，即多台服务器部署相同应用构成一个集群，通过负载均衡设备共同对外提供服务

特点：
- 提供更好的并发特性
- 服务器故障不影响用户使用

## 缓存

讲数据放在距离计算最近的位置以加快处理速度
- CDN
- 反向代理
- 本地缓存
- 分布式缓存

使用缓存的前提条件
- 数据访问热点不均衡，某些数据会被更加频繁访问
- 数据在某个时间段内有效，不会很快过期

## 异步

业务之间的消息传递不是同步调用，而是将一个业务操作分成多个阶段，每个阶段之间通过共享数据的方式异步执行进行协作。异步架构是典型的生产者消费者模式

单一服务器内可通过多线程共享内存队列的方式实现异步；
分布式系统，多个服务器集群通过分布式消息队列实现异步。

特性：
- 提高系统可用性
- 加快网站响应速度
- 消除并发访问高峰
- 使用异步可能会对用户体验、业务流程造成影响

## 冗余

要保证在服务器宕机的情况下网站依然可以继续服务，不丢失数据，需要一定程度的服务器冗余运行，数据冗余备份，这样某台服务器宕机时，可将其上的服务和数据访问转移到其他机器上

访问和负载很小的服务也必须部署至少两台服务器构成集群，目的就是通过冗余实现服务高可用。

数据库除了定期备份，存档保存，实现冷备份外，为了保证在线业务的高可用，还需要对数据库进行主从分离，实时同步实现热备份

应对不可抗力还会部署灾备数据中心

## 自动化

- 发布过程自动化
- 自动化代码管理
- 自动化测试
- 自动化安全检测
- 自动化部署
- 自动化监控
- 自动化报警
- 自动化失效转移
- 自动化失效恢复
- 自动化降级
- 自动化分配资源

## 安全

- 密码和手机校验码身份认证
- 网络通信加密
- 验证码防机器人
- xss注入 sql注入
- 敏感信息过滤
- 交易转账风险控制

---


# 要素

## 性能

性能是网站的一个重要指标，包括响应时间、TPS、系统性能计数器等

主要优化点

- 浏览器端，浏览器缓存、使用页面压缩、合理布局页面、减少cookie传输等
- 使用CDN，部署反向代理
- 应用服务器端，本地缓存和分布式缓存，异步操作，部署集群
- 代码层面，使用多线程，改善内存管理
- 数据库端，索引、缓存、SQL优化
- NoSQL优化数据模型、存储结构、伸缩特性等


## 可用性

主要手段是冗余

- 软件开发中，进行预发布验证、自动化测试、灰度发布等
- 应用服务器，使用负载均衡组成集群，前提不能保存会话
- 存储服务器，实时备份


## 伸缩性

衡量架构伸缩性的主要标准：
- 是否可以用多台服务器构建集群
- 是否容易向集群中添加新的服务器
- 加入新的服务器是否可以提供和原来无差别的服务
- 集群中可容纳的总的服务器是否有限制

对于应用服务器集群，只要服务器上不保存数据，所有服务器都是对等的，通过使用合适的负载均衡设备就可以向集群中不断加入服务器。

对于缓存服务器集群，加入新的服务器可能导致缓存路由失效，进而导致集群中大部分缓存都无法访问。虽然缓存的数据可以通过数据库重新加载，但是如果应用已经严重依赖缓存，可能会导致整个网站崩溃。需要改进缓存路由算法保证缓存数据的可访问性。

关系型数据库虽然支持数据复制，主从热备等机制，但是很难做到大规模集群的可伸缩性，因此关系型数据库的集群伸缩性方案必须在数据库之外实现，通过路由分区等手段将部署有多个数据库的服务器组成一个集群。

大部分NoSQL数据库产品，先天就是为海量数据而生，因此对伸缩性支持的都非常好，可以实现集群规模的线性伸缩。

## 扩展性

衡量网站架构扩展性的主要标准：

- 增加新业务产品时，是否可以实现对现有产品透明无影响，不需要改动活甚少改动既有业务功能
- 不同产品之间是否很少耦合，一个产品的改动对其他产品无影响

主要手段：

- 事件驱动架构
    - 通常利用消息队列实现
    - 通过这种方式将消息的产生和处理分离，即可透明的增加新的生产者任务或消费者任务
- 分布式服务
    - 将业务和可复用服务分离，通过分布式服务框架调用
    - 新增产品可调用可复用的服务实现自身业务逻辑
    - 可复用服务升级变更时，也可以通过提供多版本服务实现透明升级
- 提供开发平台接口
    - 提供给第三方开发者使用

## 安全性

标准：
- 针对现存和潜在的各种攻击和窃密手段，是否有可靠的应对策略