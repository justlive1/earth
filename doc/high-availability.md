网站的高可用架构

---

# 网站可用性的度量与考核

- 网站的可用性度量
    - 网站不可用时间 = 故障修复时间点 - 故障发现时间点
    - 网站年度可用性指标 = (1 - 网站不可用时间/年度时间) * 100%s
- 网站可用性考核

# 高可用的应用

- 应用层主要处理网站应用的业务逻辑，显著特点是应用的无状态性
- 所谓无状态的应用是指应用服务器不保存业务的上下午信息，仅根据每次请求提交的数据进行相应的业务逻辑处理，多个服务器实例完全对等
- 通过负载均衡进行无状态服务的失效转移
- 应用服务器集群的Session管理
    - Session复制
    - Session绑定
        - 负载均衡原地址Hash算
    - 利用Cookie记录Session
    - Session服务器

# 高可用的服务

- 分级管理
- 超时设置
- 异步调用
- 服务降级
    - 拒绝服务
        - 拒绝低优先级的服务
        - 随机拒绝部分请求
    - 关闭功能
        - 关闭部分不重要的功能
- 幂等性设计

# 高可用的数据

- CAP
    - 数据持久性
    - 数据可访问性
    - 数据一致性
    - CAP原理：一个提供数据服务的存储系统无法同时满足数据一致性、数据可用性、分区耐受性(系统具有跨网络分区的伸缩性)
    - 数据强一致
    - 数据用户一致
    - 数据最终一致

- 数据备份

- 失效转移
    - 失效确认
    - 访问转移
    - 数据恢复
    
# 高可用网站的质量保证

- 网站发布
	- 集群部分机器停机发布
- 自动化测试
	- Selenium
- 预发布验证
- 代码控制
	- 主干开发 分支发布
	- 分支开发 主干发布
- 自动化发布
- 灰度发布

# 网站运行监控

- 监控数据采集
	- 用户行为日志收集
		- 浏览器上所有操作、操作环境、用户操作系统、浏览器版本信息、ip、页面访问路径、页面停留时间等
		- 服务器端日志收集
		- 客户端浏览器日志收集
	- 服务器性能监控
		- 系统load、内存占用、磁盘IO、网络IO
		- Ganglia
	- 运行数据报告
		- 业务场景相关的技术和业务指标
		- 缓冲命中率、平均响应延迟时间、每分钟发送邮件数目、待处理任务总数等
- 监控管理
	- 系统报警
	- 失效转移
	- 自动优雅降级
